연결
===

## 세션, 쿠키
* 클라이언트와 서버의 연결을 유지하는 방법
### 세션(Session)과 쿠키(Cookie)
* Connectionless Protocol
    - 웹 서비스는 HTTP 프로토콜을 기반으로 하는데, HTTP 프로트콜은 클라이언트와 서버의 관계를 유지하지 않는 특징이 있다.
<img src="/images/38.png" />

* 서버의 부하를 줄일 수 있는 장점은 있으나, 클라이언트의 요청 시마다 서버와 매번 새로운 연결이 생성되기 때문에 일반적인 로그인 상태 유지, 장바구니 등의 기능을 구현하기 어렵다.
<img src="/images/39.png" />

* 이러한 Connectionless Protocol의 불편함을 해결하기 위해서 **세션**과 **쿠키**를 이용한다.
    - 세션과 쿠키는 클라이언트와 서버의 연결 상태를 유지해주는 방법이다.(공통점)
    - 세션: **서버**에서 연결 정보를 관리한다.
    - 쿠키: **클라이언트**에서 연결 정보를 관리한다.

### HttpServletRequest를 이용한 세션 사용
* 사용 예시
<img src="/images/40.png" />

* 스프링 MVC에서 HttpServletRequest를 이용해서 세션을 이용하려면 컨트롤러의 메소드에서 파라미터로 **HttpServletRequet**를 받으면 된다.
<img src="/images/41.png" />

* 세션 생성
    - 최초 로그인 상황
    - 정확하게는 request의 세션에 속성(예: mem객체)를 추가한다.
```
// login method
@RequestMapping(value="/login", method=RequestMethod.POST)
public String memLogin(Member member, HttpServletRequest request) {
    
    Member mem = service.memberSearch(member);
    
    HttpSession session = request.getSession();
    session.setAttribute("member", mem);
    
    return "/member/loginOk";
}
```
* 생성된 세션 사용
    - 회원 정보 수정 상황
```
@RequestMapping(value = "/modify", method = RequestMethod.POST)
public ModelAndView modify(Member member, HttpServletRequest request) {
	
	HttpSession session = request.getSession();
	
	Member mem = service.memberModify(member);
	session.setAttribute("member", mem);
		
	ModelAndView mav = new ModelAndView();
	mav.addObject("memAft", mem);
	mav.setViewName("/member/modifyOk");
		
	return mav;
}
```

### HttpSession을 이용한 세션 사용
* HttpServletRequest와 HttpSession의 차이점은 거의 없으며, 단지 세션 객체를 얻는 방법에 차이가 있을 뿐이다.
    - HttpServletRequest는 파라미터로 HttpServletRequest를 받은 후, getSession()으로 HttpSession 타입의 세션을 얻는다.
    - HttpSession은 파라미터로 HttpSession을 받아 HttpSession 타입의 세션을 사용한다.
    - HttpSession이 HttpServletRequest보다 한단계 더 간단하게 세션을 사용할 수 있다.
* 생성 예시
```
// HttpSession
public String memLogin(Member member, HttpSession session) {
    
    Member mem = service.memberSearch(member);
    
    session.setAttribute("member", mem);
    
    return "/member/loginOk";
}
```

### 세션 삭제
* 세션을 삭제하는 방법은 세션에 저장된 속성이 더 이상 필요없을 때 이루어지는 과정으로 주로 로그아웃 또는 회원 탈퇴 등에 사용된다.
    - 세션 삭제를 정확하게 표현한다면, 세션의 속성(예; member 객체)을 삭제한다라고 하는 것이 정확한 표현이다.
* 로그아웃일 경우 세션 삭제
```
// HttpServletRequest 이용시 세션 삭제 방법
@RequestMapping("/logout")
public String memLogout(Member member, HttpServletRequest request) {
		
	HttpSession session = request.getSession();
	session.invalidate();
	
	return "/member/logoutOk";
}

// HttpSession 이용시 세션 삭제 방법
@RequestMapping("/logout")
public String memLogout(Member member, HttpSession session) {
		
	session.invalidate();
		
	return "/member/logoutOk";
}
```

* 회원 탈퇴일 경우 세션 삭제
```
@RequestMapping(value = "/remove", method = RequestMethod.POST)
public String memRemove(Member member, HttpServletRequest request) {
		
	service.memberRemove(member);
		
	HttpSession session = request.getSession();
	session.invalidate();
		
	return "/member/removeOk";
}
```
### 세션 주요 메소드
* **getId()**: 세션 ID를 반환한다.
* **setAttribute()**: 세션 객체에 속성을 저장한다.
* **getAttribute()**: 세션 객체에 저장된 속성을 반환한다.
* removeAttribute(): 세션 객체에 저장된 속성을 제거한다.
* setMaxInactiveInterval(): 세션 객체의 유지시간을 설정한다.
* getMaxInactiveInterval(): 세션 객체의 유지시간을 반환한다.
* **invalidate()**: 세션 객체의 모든 정보를 삭제한다.

### 세션 플로우
<img src="/images/42.png" />

### 쿠키(Cookie)
* 사용자의 로컬 컴퓨터(클라이언트)에 정보가 저장된다.
    - 때문에 세션보다 보안에 취약하다는 단점이 있다.
    - 그러나 서버의 부하를 줄일 수 있다는 장점도 있다.
* **쿠키 생성 코드**
    - mallMain()에서 쿠키를 생성하고, 파라미터로 받은 HttpServletResponse에 쿠키를 담고 있다.
    - 쿠키를 생성할 때는 생성자에 두 개의 파라미터를 넣어주는데 첫 번째는 쿠키이름을 넣어주고 두 번째는 쿠키값을 넣어준다.
<img src="/images/43.png" />

* setMaxAge(): 쿠키를 유지하는 기간 설정 메소드
* 쿠키 생성의 정확한 표현: HttpServletResponse 타입의 response에 Cookie를 추가한다.
* **생성된 쿠키 사용 코드**
    - mallMain()에서 생성된 쿠키를 mallIndex()에서 사용한다.
    - 쿠키를 사용할 때는 @CookieValue를 사용한다.
 <img src="/images/44.png" />   

* @CookieValue 어노테이션
    - @CookieValue 어노테이션의 value속성은 쿠키 이름을 나타내는데, 만약 value에 명시한 쿠키가 없을 경우 익셉션이 발생한다.
    - required 속성을 이용해 익셉션을 막을 수도 있다.
        + Required 속성은 기본값으로 true를 갖고 있는데, required가 true인 경우 value값에 해당하는 쿠키가 없으면 익셉션이 발생한다.
        + 따라서, required 속성값을 false로 설정해서 value값에 해당하는 쿠키가 없어도 익셉션이 발생하지 않도록 한다.
 
## 리다이렉트, 인터셉트
## Database
## JDBC
## Jdbc Template 